/*
 *  jQuery ajaxPending
 *  Author: Hugo Heyman
 *
 *  Show "spinner" and dim effect on element X when url Y has a pending ajax call
 *
 *  Usage:
 *  $("some-element").ajaxPending(url, override_css)
 *  
 *  Usage examples:
 *  $("#weather").ajaxPending("/weather/update");
 *  $("#news-feed").ajaxPending("/news/fetch-more", {"background-color": "rgba(50,50,50,0.5)"});
 */

jQuery.fn.ajaxPending = function(url, override_css) {

    var default_css = {
        "display": "block",
        "position": "absolute",
        "z-index": "1000",
        "background-image": "url('data:image/gif;base64,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')",
        "background-repeat": "no-repeat",
        "background-color": "rgba(255,255,255,0.5)",
        "background-size": "auto",
        "background-position": "50% 10%"
    }

    var css = $.extend({}, default_css, override_css);

    return this.each(function() {
        var $target = $(this);
        var $spinner = $('<div class="ajax-pending-container"></div>');
        $spinner.css(css);
        
        $(document).ajaxSend(function(event, request, options) {
            if(options.url === url) {
                $spinner.css({
                    "width": $target.outerWidth() +"px",
                    "height": $target.outerHeight() +"px",
                    "top": $target.offset().top + "px",
                    "left": $target.offset().left + "px"
                });
                $spinner.appendTo("body");
            }
        });

        $(document).ajaxComplete(function(event, request, options) {
            if(options.url === url) {
                $spinner.remove();
            }
        });
    });
}