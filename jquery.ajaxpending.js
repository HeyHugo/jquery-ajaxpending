/*
 *  jQuery ajaxPending
 *  Author: Hugo Heyman
 *
 *  Show "spinner" and dim effect on element X when url Y has a pending ajax call
 *
 *  Usage:
 *  $("some-element").ajaxPending(url, override_css)
 *  
 *  Usage examples:
 *  $("#weather").ajaxPending("/weather/update");
 *  $("#news-feed").ajaxPending("/news/fetch-more", {interval: 35, container_css: {"background-color": "rgba(50,50,50,0.5)"}});
 */

jQuery.fn.ajaxPending = function(url, options) {

    var defaults = {
        animation_interval: 35,
        sprite_count: 19,
        container_css: {
            "display": "block",
            "position": "absolute",
            "z-index": "1000",
            "background-color": "rgba(255,255,255,0.5)"
        },
        spinner_css: {
            "display": "block",
            "width": "32px",
            "height": "32px",
            "margin-top": "10%",
            "z-index": "1001",
            "background-repeat": "no-repeat",
            "background-image": "url('data:image/png;base64,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')",
            "position": "relative"
        }
    }

    var settings = $.extend(true, {}, defaults, options);

    return this.each(function() {
        var loop;
        var $target = $(this);
        var $container = $('<div class="ajax-pending-container"></div>').css(settings.container_css);
        var $spinner = $('<div class="ajax-pedning-spinner"></div>').css(settings.spinner_css);

        $container.html($spinner);
        
        $(document).ajaxSend(function(event, request, options) {
            if(options.url === url) {
                $container.css({
                    "width": $target.outerWidth() +"px",
                    "height": $target.outerHeight() +"px",
                    "top": $target.offset().top + "px",
                    "left": $target.offset().left + "px"
                });
                $spinner.css("left", ($container.width()/2) - ($spinner.width()/2));
                $container.appendTo("body");
                start_animation();
            }
        });

        $(document).ajaxComplete(function(event, request, options) {
            if(options.url === url) {
                stop_animation();
                $container.remove();
            }
        });

        function start_animation() {
            var count = 0;
            loop = setInterval(function() {
                $spinner.css("background-position", "0px " + $spinner.width()*count*(-1) + "px");
                count = (count+1) % settings.sprite_count;
            }, settings.animation_interval);
        }

        function stop_animation() {
            clearInterval(loop);
        }
    });
}
